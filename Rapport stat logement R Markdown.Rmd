---
title: "Rapport d’étude - Performance Énergétique"
output:
  word_document: default
  html_document: default
---

```{r setup, include=FALSE}
# Installation et chargement des packages nécessaires
knitr::opts_chunk$set(echo = FALSE)  # Masque le code dans tous les chunks
if (!require(ggplot2)) install.packages('ggplot2', dependencies=TRUE)
if (!require(dplyr)) install.packages('dplyr', dependencies=TRUE)

library(ggplot2)
library(dplyr)
```

# Introduction

Ce rapport présente une analyse des performances énergétiques des logements en France, en se basant sur les données disponibles.

# Partie 1 Chargement des Données

Afin de commencer ce rapport statistiques, nous avons tout d'abbord presenter le contexte avec un tableau des données avec leurs noms et quelques valeurs
```{r}
# Chargement des données CSV depuis l'emplacement local

# Définir l'URL du fichier ZIP sur GitHub
url_zip <- "https://github.com/lgcgwen/iut_sd2_rshiny_enedis/raw/main/logement_finale%20-%20Copie.zip"

# Télécharger le fichier ZIP
download.file(url_zip, destfile = "logement_finale.zip", mode = "wb")

# Décompresser le fichier ZIP
unzip("logement_finale.zip")

# Chargement des données CSV depuis le fichier décompressé
logement_data <- read.csv("logement_finale.csv", 
                          sep = ",", dec = ".", header = TRUE, stringsAsFactors = FALSE)

# Nettoyage des colonnes pour éviter les caractères spéciaux
colnames(logement_data) <- gsub("[^[:alnum:]_]", "", colnames(logement_data))

# Vérification du nombre de lignes et colonnes
dim(logement_data)

# Aperçu des premières lignes du jeu de données
head(logement_data)
```

# Partie 2  KPI Pertinents
Dans cette parti on s'interesse a la preentation de quelques indicateurs interessants pour les variables de conso de chauffage, conso ECS et conso d'eclairage
```{r}
# Calcul des moyennes, maximums et totaux des coûts et consommations pour l'ensemble des données
kpi_data <- logement_data %>%
  summarise(
    mean_chauffage = mean(Coût_chauffage, na.rm = TRUE),
    max_chauffage = max(Coût_chauffage, na.rm = TRUE),
    total_chauffage = sum(Coût_chauffage, na.rm = TRUE),
    
    mean_ECS = mean(Coût_ECS, na.rm = TRUE),
    max_ECS = max(Coût_ECS, na.rm = TRUE),
    total_ECS = sum(Coût_ECS, na.rm = TRUE),
    
    mean_eclairage = mean(Coût_éclairage, na.rm = TRUE),
    max_eclairage = max(Coût_éclairage, na.rm = TRUE),
    total_eclairage = sum(Coût_éclairage, na.rm = TRUE)
  )

# Affichage des KPI
kpi_data
```

# Partie 3 Graphiques ( histogramme, diagramme)

Dans cette partie, on a utiliser des graphiques, notamment un hisotgramme avec la repartiton en % des etiquette_DPE et egalement un diagramme egalement en % qui represente la part de tout les couts (chauffage, energie, auxiliaire ...)
```{r}
# Pourcentage de logements par étiquette DPE
dpe_counts <- logement_data %>%
  group_by(Etiquette_DPE) %>%
  summarise(count = n()) %>%
  mutate(percentage = count / sum(count) * 100)

ggplot(dpe_counts, aes(x = Etiquette_DPE, y = percentage, fill = Etiquette_DPE)) +
  geom_bar(stat = "identity") +
  labs(title = "Pourcentage de Logements par Étiquette DPE", 
       x = "Étiquette DPE", y = "Pourcentage (%)") +
  theme_minimal() +
  scale_fill_brewer(palette = "Pastel1")

```


```{r}
# Calcul des sommes totales de chaque type de coût
total_costs <- logement_data %>%
  summarise(
    Total_Coût_chauffage = sum(Coût_chauffage, na.rm = TRUE),
    Total_Coût_éclairage = sum(Coût_éclairage, na.rm = TRUE),
    Total_Coût_total_5_usages = sum(Coût_total_5_usages, na.rm = TRUE),
    Total_Coût_auxiliaires = sum(Coût_auxiliaires, na.rm = TRUE),
    Total_Coût_refroidissement = sum(Coût_refroidissement, na.rm = TRUE)
  )

# Transformation des données pour être utilisables dans ggplot
cost_data <- data.frame(
  Category = c("Coût Chauffage", "Coût Éclairage", "Coût Total 5 Usages", 
               "Coût Auxiliaires", "Coût Refroidissement"),
  Total = c(
    total_costs$Total_Coût_chauffage,
    total_costs$Total_Coût_éclairage,
    total_costs$Total_Coût_total_5_usages,
    total_costs$Total_Coût_auxiliaires,
    total_costs$Total_Coût_refroidissement
  )
)

# Calcul des pourcentages
cost_data <- cost_data %>%
  mutate(Percentage = Total / sum(Total) * 100)

# Création d'un diagramme circulaire avec pourcentages
ggplot(cost_data, aes(x = "", y = Total, fill = Category)) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar(theta = "y") +
  geom_text(aes(label = paste0(round(Percentage, 1), "%")), 
            position = position_stack(vjust = 0.5)) + # Ajout des étiquettes de pourcentages
  labs(title = "Répartition des Coûts Énergétiques par Catégorie") +
  theme_void() + # Pour enlever l'arrière-plan
  scale_fill_brewer(palette = "Set3")
```


# Partie 4 : Matrice et coefficiant de correlation 

Cette derniere partie comprends une matrice de correlation entre
plusieurs variables (Coût_chauffage, Cout_eclairage,Cout_ECS et la surface habitable des logements). Il y a egalement un tableau pour resumer les coefficiants de la matrice

```{r}
# Charger la bibliothèque corrplot si elle n'est pas installée
if (!require(corrplot)) install.packages('corrplot', dependencies=TRUE)
library(corrplot)

# Sélection des colonnes numériques pertinentes pour la matrice de corrélation
vars <- logement_data %>%
  select(Coût_chauffage, Coût_éclairage, Coût_ECS, Surface_habitable_logement)

# Calcul de la matrice de corrélation
cor_matrix <- cor(vars, use = "complete.obs")

# Affichage de la matrice de corrélation
corrplot(cor_matrix, method = "circle", type = "upper", tl.col = "black", tl.cex = 0.8)
# Affichage des coefficients de corrélation sous forme de tableau
cor_matrix
```

On remarque grace a la matrice et aux coefficiants que la surface habitable du logement est fortement correler au cout d'eclairage. Au contraire le cout de chauffage et le cout d'eclairage sont tres peu correler entre eux.





